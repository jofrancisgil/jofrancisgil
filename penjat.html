<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Penjat Interactiu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
        body { font-family: 'Fredoka', sans-serif; }

        /* Estil de les tecles */
        .key-btn {
            transition: all 0.2s;
            touch-action: manipulation;
        }
        .key-btn:active { transform: scale(0.95); }
        .key-btn:disabled { cursor: not-allowed; opacity: 0.8; transform: none; }
        
        /* Estats de les tecles */
        .key-correct { background-color: #22c55e !important; color: white !important; border-color: #16a34a !important; }
        .key-wrong { background-color: #ef4444 !important; color: white !important; border-color: #dc2626 !important; opacity: 0.4 !important; }

        /* AnimaciÃ³ de lletres apareixent */
        .letter-reveal {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn {
            from { opacity: 0; transform: translateY(10px) scale(0.5); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
    </style>
</head>
<body class="bg-slate-800 text-white min-h-screen flex items-center justify-center p-4">

    <div class="w-full max-w-4xl bg-slate-900 rounded-3xl shadow-2xl overflow-hidden border border-slate-700">
        
        <!-- CAPÃ‡ALERA -->
        <header class="bg-slate-800 p-4 border-b border-slate-700 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="bg-indigo-500 p-2 rounded-lg">
                    <i data-lucide="skull" class="w-6 h-6 text-white"></i>
                </div>
                <h1 class="text-xl font-bold text-indigo-100">El Penjat</h1>
            </div>
            <button onclick="resetGame()" class="text-xs font-bold text-slate-400 hover:text-white transition-colors flex items-center gap-1">
                <i data-lucide="rotate-ccw" class="w-4 h-4"></i> REINICIAR
            </button>
        </header>

        <!-- FASE 1: CONFIGURACIÃ“ (Introduir Paraula) -->
        <div id="setupScreen" class="p-8 md:p-12 text-center">
            <div class="mb-8">
                <div class="w-24 h-24 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 border-4 border-slate-700">
                    <i data-lucide="pencil" class="w-10 h-10 text-indigo-400"></i>
                </div>
                <h2 class="text-3xl font-bold mb-2">Prepara la partida</h2>
                <p class="text-slate-400">Escriu la paraula o frase secreta per als jugadors.</p>
            </div>

            <div class="max-w-md mx-auto space-y-4">
                <div class="relative">
                    <input type="password" id="secretInput" 
                        class="w-full bg-slate-800 border-2 border-slate-600 rounded-xl p-4 text-center text-xl tracking-widest focus:border-indigo-500 focus:outline-none transition-colors text-white placeholder-slate-600"
                        placeholder="ESCRIU AQUÃ..." autocomplete="off">
                    <button onmousedown="togglePassword(true)" onmouseup="togglePassword(false)" onmouseleave="togglePassword(false)"
                        class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 hover:text-indigo-400">
                        <i data-lucide="eye" class="w-5 h-5"></i>
                    </button>
                </div>
                
                <button onclick="startGame()" class="w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl shadow-lg shadow-indigo-500/20 transition-all transform hover:-translate-y-1">
                    COMENÃ‡AR JOC
                </button>
            </div>
        </div>

        <!-- FASE 2: JOC -->
        <div id="gameScreen" class="hidden flex flex-col md:flex-row h-full min-h-[500px]">
            
            <!-- Zona Esquerra: Dibuix -->
            <div class="md:w-1/3 bg-slate-950 p-6 flex flex-col items-center justify-center border-r border-slate-800 relative">
                <canvas id="hangmanCanvas" width="250" height="300" class="max-w-full"></canvas>
                
                <!-- Comptador d'errors -->
                <div class="mt-4 bg-slate-900 px-4 py-2 rounded-full border border-slate-800 text-sm font-bold text-red-400">
                    Errades: <span id="errorCount">0</span> / 9
                </div>
            </div>

            <!-- Zona Dreta: Paraula i Teclat -->
            <div class="md:w-2/3 p-6 flex flex-col">
                
                <!-- Paraula Secreta -->
                <div id="wordDisplay" class="flex-1 flex flex-wrap items-center justify-center gap-2 mb-8 content-center min-h-[100px]">
                    <!-- Les lletres es generen aquÃ­ -->
                </div>

                <!-- Missatge de Resultat -->
                <div id="resultMessage" class="hidden text-center mb-6 p-4 rounded-xl font-bold text-xl animate-bounce">
                    <!-- Text dinÃ mic -->
                </div>

                <!-- Teclat -->
                <div id="keyboard" class="grid grid-cols-7 gap-2 md:gap-3 max-w-2xl mx-auto w-full">
                    <!-- Les tecles es generen aquÃ­ -->
                </div>

                <!-- BotÃ³ Torna a Jugar (ocult inicialment) -->
                <div id="playAgainBtn" class="hidden mt-6 text-center">
                    <button onclick="resetGame()" class="px-8 py-3 bg-white text-slate-900 font-bold rounded-lg hover:bg-slate-200 transition-colors">
                        Nova Partida
                    </button>
                </div>
            </div>
        </div>

    </div>

    <script>
        lucide.createIcons();

        // ConfiguraciÃ³
        const MAX_ERRORS = 9;
        const ALPHABET = "ABCÃ‡DEFGHIJKLMNOPQRSTUVWXYZ";
        
        // Estat del joc
        let secretPhrase = "";
        let normalizedPhrase = ""; // Sense accents per comparar
        let guessedLetters = new Set();
        let errors = 0;
        let isGameOver = false;

        // Elements DOM
        const setupScreen = document.getElementById('setupScreen');
        const gameScreen = document.getElementById('gameScreen');
        const secretInput = document.getElementById('secretInput');
        const wordDisplay = document.getElementById('wordDisplay');
        const keyboard = document.getElementById('keyboard');
        const canvas = document.getElementById('hangmanCanvas');
        const ctx = canvas.getContext('2d');
        const errorCountDisplay = document.getElementById('errorCount');
        const resultMessage = document.getElementById('resultMessage');
        const playAgainBtn = document.getElementById('playAgainBtn');

        // Normalitzar text (treure accents per a la lÃ²gica de joc)
        function normalizeText(text) {
            return text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toUpperCase();
        }

        // Mostrar/Amagar contrasenya a l'input
        function togglePassword(show) {
            secretInput.type = show ? "text" : "password";
        }

        function startGame() {
            const val = secretInput.value.trim();
            if (val.length < 2) {
                alert("Si us plau, escriu una paraula o frase mÃ©s llarga.");
                return;
            }

            secretPhrase = val.toUpperCase();
            normalizedPhrase = normalizeText(secretPhrase);
            
            // Reiniciar estat
            guessedLetters.clear();
            errors = 0;
            isGameOver = false;
            
            // UI Switch
            setupScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            resultMessage.classList.add('hidden');
            playAgainBtn.classList.add('hidden');
            
            // Netejar canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.strokeStyle = '#e2e8f0'; // Slate-200
            ctx.lineWidth = 4;
            ctx.lineCap = 'round';
            errorCountDisplay.innerText = 0;

            renderWord();
            renderKeyboard();
        }

        function resetGame() {
            secretInput.value = "";
            gameScreen.classList.add('hidden');
            setupScreen.classList.remove('hidden');
        }

        // Dibuixar la paraula amb guions o lletres
        function renderWord() {
            wordDisplay.innerHTML = '';
            let allGuessed = true;

            // Dividir per carÃ cters per gestionar espais i lletres
            for (let i = 0; i < secretPhrase.length; i++) {
                const char = secretPhrase[i];
                const normChar = normalizedPhrase[i];
                
                const span = document.createElement('div');
                span.className = "w-10 h-12 md:w-12 md:h-16 flex items-center justify-center text-2xl md:text-3xl font-bold rounded-lg border-b-4 mx-1 transition-all";
                
                if (char === ' ') {
                    // Espai buit
                    span.className = "w-6 h-16 flex items-center justify-center"; // MÃ©s estret
                    span.innerHTML = "&nbsp;";
                } else if (guessedLetters.has(normChar) || !ALPHABET.includes(normChar)) {
                    // Lletra endevinada o carÃ cter especial (ex: guiÃ³, coma)
                    span.innerText = char; // Mostrem l'original (amb accent si en tÃ©)
                    span.className += " bg-slate-700 border-slate-600 text-white letter-reveal";
                } else {
                    // Lletra oculta
                    span.innerText = "";
                    span.className += " bg-slate-800 border-slate-600 text-transparent";
                    allGuessed = false;
                }

                wordDisplay.appendChild(span);
            }

            if (allGuessed && !isGameOver) {
                handleWin();
            }
        }

        // Dibuixar el teclat
        function renderKeyboard() {
            keyboard.innerHTML = '';
            
            for (let letter of ALPHABET) {
                const btn = document.createElement('button');
                btn.innerText = letter;
                btn.className = "key-btn h-12 rounded-lg font-bold bg-slate-700 border-b-4 border-slate-900 hover:bg-slate-600 text-white";
                
                // Estat de la tecla
                if (guessedLetters.has(letter)) {
                    btn.disabled = true;
                    if (normalizedPhrase.includes(letter)) {
                        btn.classList.add('key-correct');
                    } else {
                        btn.classList.add('key-wrong');
                    }
                }

                btn.onclick = () => handleGuess(letter);
                keyboard.appendChild(btn);
            }
        }

        function handleGuess(letter) {
            if (isGameOver || guessedLetters.has(letter)) return;

            guessedLetters.add(letter);
            
            if (normalizedPhrase.includes(letter)) {
                // Encert
                renderWord();
            } else {
                // Error
                errors++;
                errorCountDisplay.innerText = errors;
                drawHangmanStep(errors);
                
                if (errors >= MAX_ERRORS) {
                    handleLoss();
                }
            }
            renderKeyboard(); // Actualitzar colors
        }

        // LÃ²gica de Dibuix (9 passos)
        function drawHangmanStep(step) {
            ctx.beginPath();
            
            switch(step) {
                case 1: // Base
                    ctx.moveTo(20, 280); ctx.lineTo(180, 280);
                    break;
                case 2: // Pal Vertical
                    ctx.moveTo(50, 280); ctx.lineTo(50, 20);
                    break;
                case 3: // Pal Superior
                    ctx.moveTo(50, 20); ctx.lineTo(150, 20);
                    break;
                case 4: // Corda
                    ctx.moveTo(150, 20); ctx.lineTo(150, 50);
                    break;
                case 5: // Cap
                    ctx.arc(150, 80, 30, 0, Math.PI * 2);
                    break;
                case 6: // Cos
                    ctx.moveTo(150, 110); ctx.lineTo(150, 200);
                    break;
                case 7: // BraÃ§ esquerre
                    ctx.moveTo(150, 130); ctx.lineTo(120, 170);
                    break;
                case 8: // BraÃ§ dret
                    ctx.moveTo(150, 130); ctx.lineTo(180, 170);
                    break;
                case 9: // Cames (totes dues per acabar)
                    ctx.moveTo(150, 200); ctx.lineTo(120, 250); // Esquerra
                    ctx.moveTo(150, 200); ctx.lineTo(180, 250); // Dreta
                    break;
            }
            
            ctx.stroke();
        }

        function handleWin() {
            isGameOver = true;
            const isPhrase = secretPhrase.includes(' ');
            
            resultMessage.classList.remove('hidden', 'bg-red-500/20', 'text-red-300');
            resultMessage.classList.add('bg-green-500/20', 'text-green-300', 'border', 'border-green-500/50');
            resultMessage.innerHTML = isPhrase ? 
                `ðŸŽ‰ FRASE CORRECTA! ðŸŽ‰` : 
                `ðŸŽ‰ PARAULA CORRECTA! ðŸŽ‰`;
            
            playAgainBtn.classList.remove('hidden');

            // Confeti
            confetti({
                particleCount: 150,
                spread: 70,
                origin: { y: 0.6 }
            });
        }

        function handleLoss() {
            isGameOver = true;
            
            // Revelar tot
            for (let char of normalizedPhrase) {
                if(ALPHABET.includes(char)) guessedLetters.add(char);
            }
            renderWord();

            resultMessage.classList.remove('hidden', 'bg-green-500/20', 'text-green-300');
            resultMessage.classList.add('bg-red-500/20', 'text-red-300', 'border', 'border-red-500/50');
            resultMessage.innerHTML = `ðŸ’€ HAS PERDUT!<br><span class="text-sm text-white mt-1 block">La resposta era: ${secretPhrase}</span>`;
            
            playAgainBtn.classList.remove('hidden');
            
            // Desactivar teclat visualment
            renderKeyboard();
        }

    </script>
</body>
</html>
