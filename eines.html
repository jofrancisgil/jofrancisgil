<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caixa d'Eines - Jo Recursos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, .brand-font { font-family: 'Fredoka', sans-serif; }
        
        /* Animació suau d'entrada */
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Estils Moneda */
        .coin-container { perspective: 1000px; }
        .coin {
            width: 150px; height: 150px; position: relative; transform-style: preserve-3d;
            transition: transform 3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .coin div {
            position: absolute; width: 100%; height: 100%; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem; font-weight: bold; backface-visibility: hidden;
            border: 8px solid #ca8a04; box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
        }
        .side-a { background-color: #facc15; color: #854d0e; } /* Cara */
        .side-b { background-color: #eab308; color: #713f12; transform: rotateY(180deg); } /* Creu */

        /* Estils Daus */
        .die {
            width: 80px; height: 80px; background: white; border: 2px solid #cbd5e1;
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-size: 2rem; font-weight: bold; color: #334155;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            animation: roll 0.5s ease-in-out;
        }
        @keyframes roll {
            0% { transform: rotate(0deg) scale(0.8); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* Estils Temporitzador */
        .timer-circle { transition: stroke-dashoffset 1s linear; }
        /* Amagar les fletxes dels inputs numèrics */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col">

    <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 flex justify-between h-20 items-center">
            <a href="gestio.html" class="flex items-center gap-2 text-slate-600 hover:text-indigo-600 transition">
                <i data-lucide="arrow-left" class="w-5 h-5"></i> Tornar
            </a>
            <span class="text-2xl font-bold text-slate-800 brand-font">Caixa d'Eines</span>
        </div>
    </nav>

    <main class="flex-grow py-8 px-4">
        <div class="max-w-4xl mx-auto">

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                <button onclick="switchTool('coin')" id="btn-coin" class="tool-btn active bg-white p-4 rounded-xl border-2 border-slate-200 hover:border-yellow-400 hover:bg-yellow-50 transition flex flex-col items-center gap-2 group">
                    <i data-lucide="circle-dollar-sign" class="w-8 h-8 text-yellow-500 group-hover:scale-110 transition"></i>
                    <span class="font-bold text-slate-700">Moneda</span>
                </button>
                <button onclick="switchTool('dice')" id="btn-dice" class="tool-btn bg-white p-4 rounded-xl border-2 border-slate-200 hover:border-indigo-400 hover:bg-indigo-50 transition flex flex-col items-center gap-2 group">
                    <i data-lucide="dices" class="w-8 h-8 text-indigo-500 group-hover:scale-110 transition"></i>
                    <span class="font-bold text-slate-700">Daus</span>
                </button>
                <button onclick="switchTool('picker')" id="btn-picker" class="tool-btn bg-white p-4 rounded-xl border-2 border-slate-200 hover:border-emerald-400 hover:bg-emerald-50 transition flex flex-col items-center gap-2 group">
                    <i data-lucide="users" class="w-8 h-8 text-emerald-500 group-hover:scale-110 transition"></i>
                    <span class="font-bold text-slate-700">Sorteig</span>
                </button>
                <button onclick="switchTool('timer')" id="btn-timer" class="tool-btn bg-white p-4 rounded-xl border-2 border-slate-200 hover:border-red-400 hover:bg-red-50 transition flex flex-col items-center gap-2 group">
                    <i data-lucide="timer" class="w-8 h-8 text-red-500 group-hover:scale-110 transition"></i>
                    <span class="font-bold text-slate-700">Temps</span>
                </button>
            </div>

            <div id="panel-coin" class="tool-panel fade-in bg-white p-8 rounded-2xl shadow-lg border border-slate-100 text-center min-h-[400px] flex flex-col items-center justify-center hidden">
                <h2 class="text-2xl font-bold mb-8 text-slate-800">Cara o Creu?</h2>
                
                <div class="coin-container mb-10">
                    <div id="theCoin" class="coin">
                        <div class="side-a">CARA</div>
                        <div class="side-b">CREU</div>
                    </div>
                </div>

                <button onclick="flipCoin()" class="px-8 py-3 bg-yellow-500 hover:bg-yellow-600 text-white font-bold rounded-xl shadow-lg shadow-yellow-200 transition active:scale-95">
                    Llençar Moneda
                </button>
                <p id="coinResult" class="mt-6 text-xl font-bold text-slate-400 min-h-[2rem]">Prem el botó...</p>
            </div>

            <div id="panel-dice" class="tool-panel fade-in bg-white p-8 rounded-2xl shadow-lg border border-slate-100 text-center min-h-[400px] flex flex-col items-center hidden">
                <h2 class="text-2xl font-bold mb-6 text-slate-800">Llençar Daus</h2>
                
                <div class="flex gap-4 mb-8 bg-slate-50 p-2 rounded-lg">
                    <div class="flex flex-col items-start">
                        <label class="text-xs font-bold text-slate-400 uppercase ml-1">Tipus</label>
                        <select id="diceType" class="p-2 rounded-lg border border-slate-200 font-bold text-slate-700">
                            <option value="6">d6 (Cubic)</option>
                            <option value="10">d10 (Decimal)</option>
                            <option value="12">d12 (Dodeca)</option>
                            <option value="20">d20 (Rol)</option>
                        </select>
                    </div>
                    <div class="flex flex-col items-start">
                        <label class="text-xs font-bold text-slate-400 uppercase ml-1">Quantitat</label>
                        <input type="number" id="diceCount" value="1" min="1" max="6" class="w-20 p-2 rounded-lg border border-slate-200 font-bold text-center">
                    </div>
                </div>

                <div id="diceContainer" class="flex flex-wrap justify-center gap-4 mb-8 min-h-[100px] items-center">
                    <div class="text-slate-300 italic">Configura i tira els daus</div>
                </div>

                <div class="mt-auto">
                    <div id="diceTotal" class="mb-4 font-bold text-indigo-600 text-xl hidden">Total: 0</div>
                    <button onclick="rollDice()" class="w-full px-8 py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl shadow-lg shadow-indigo-200 transition active:scale-95 flex items-center justify-center gap-2">
                        <i data-lucide="dices" class="w-5 h-5"></i> TIRAR
                    </button>
                </div>
            </div>

            <div id="panel-picker" class="tool-panel fade-in bg-white p-8 rounded-2xl shadow-lg border border-slate-100 min-h-[400px] hidden">
                <h2 class="text-2xl font-bold mb-4 text-slate-800 text-center">Escollir alumne a l'atzar</h2>
                
                <div class="grid md:grid-cols-2 gap-8 h-full">
                    <div class="flex flex-col">
                        <label class="text-xs font-bold text-slate-400 uppercase mb-2">Llista de Noms</label>
                        <textarea id="pickerInput" class="flex-grow w-full p-4 bg-slate-50 border border-slate-200 rounded-xl resize-none focus:ring-2 focus:ring-emerald-500 outline-none" rows="8" placeholder="Ana&#10;Pau&#10;Jordi&#10;Maria..."></textarea>
                        <div class="flex gap-2 mt-2">
                            <button onclick="pickWinner()" class="flex-grow py-3 bg-emerald-600 hover:bg-emerald-700 text-white font-bold rounded-xl shadow-md transition">
                                Escollir!
                            </button>
                            <button onclick="document.getElementById('pickerInput').value=''" class="px-3 bg-slate-100 text-slate-500 rounded-xl hover:text-red-500">
                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex flex-col items-center justify-center bg-emerald-50 rounded-2xl border border-emerald-100 p-6 relative overflow-hidden">
                        <div id="pickerResult" class="text-3xl font-black text-emerald-800 text-center z-10">
                            ?
                        </div>
                        <div id="pickerAnim" class="absolute inset-0 flex items-center justify-center text-9xl opacity-5 pointer-events-none">
                            <i data-lucide="users"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div id="panel-timer" class="tool-panel fade-in bg-white p-8 rounded-2xl shadow-lg border border-slate-100 text-center min-h-[400px] flex flex-col items-center justify-center hidden">
                <h2 class="text-2xl font-bold mb-6 text-slate-800">Temporitzador</h2>
                
                <div class="relative w-72 h-72 mb-8">
                    <svg class="w-full h-full transform -rotate-90">
                        <circle cx="144" cy="144" r="130" stroke="#f1f5f9" stroke-width="12" fill="none"></circle>
                        <circle id="timerProgress" cx="144" cy="144" r="130" stroke="#ef4444" stroke-width="12" fill="none" stroke-dasharray="817" stroke-dashoffset="0" class="timer-circle"></circle>
                    </svg>
                    
                    <div class="absolute inset-0 flex items-center justify-center">
                        
                        <div id="timerConfig" class="flex items-end gap-2 text-slate-700">
                            <div class="flex flex-col items-center">
                                <input type="number" id="inputMin" value="05" min="0" max="99" class="w-20 text-5xl font-mono font-bold text-center bg-transparent border-b-2 border-slate-200 focus:border-red-400 outline-none p-2">
                                <span class="text-xs uppercase font-bold text-slate-400 mt-1">Min</span>
                            </div>
                            <span class="text-4xl font-bold mb-6">:</span>
                            <div class="flex flex-col items-center">
                                <input type="number" id="inputSec" value="00" min="0" max="59" class="w-20 text-5xl font-mono font-bold text-center bg-transparent border-b-2 border-slate-200 focus:border-red-400 outline-none p-2">
                                <span class="text-xs uppercase font-bold text-slate-400 mt-1">Seg</span>
                            </div>
                        </div>

                        <div id="timerDisplay" class="text-6xl font-mono font-bold text-slate-700 hidden">
                            05:00
                        </div>
                    </div>
                </div>

                <div class="flex flex-col gap-4 w-full max-w-xs">
                    <button id="timerToggleBtn" onclick="toggleTimer()" class="w-full py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-xl shadow-lg shadow-red-200 transition flex items-center justify-center gap-2">
                        <i data-lucide="play" class="w-5 h-5"></i> INICIAR
                    </button>
                    <button id="timerResetBtn" onclick="resetTimer()" class="text-slate-400 hover:text-red-500 text-sm font-bold hidden">
                        CANVIAR TEMPS / RESET
                    </button>
                </div>
            </div>

        </div>
    </main>

    <script>
        lucide.createIcons();

        // --- GESTIÓ DE PANELLS ---
        function switchTool(toolId) {
            // 1. Amagar TOTS els panells (afegint la classe hidden)
            const panels = document.querySelectorAll('.tool-panel');
            panels.forEach(p => p.classList.add('hidden'));

            // 2. Desactivar estils de tots els botons
            const buttons = document.querySelectorAll('.tool-btn');
            buttons.forEach(b => {
                b.classList.remove('border-yellow-400', 'bg-yellow-50', 'border-indigo-400', 'bg-indigo-50', 'border-emerald-400', 'bg-emerald-50', 'border-red-400', 'bg-red-50');
                b.classList.add('border-slate-200', 'bg-white');
            });

            // 3. Mostrar el panell seleccionat (treure hidden)
            const activePanel = document.getElementById(`panel-${toolId}`);
            if(activePanel) activePanel.classList.remove('hidden');
            
            // 4. Activar estil del botó seleccionat
            const btn = document.getElementById(`btn-${toolId}`);
            if(btn) {
                btn.classList.remove('border-slate-200', 'bg-white');
                if(toolId === 'coin') btn.classList.add('border-yellow-400', 'bg-yellow-50');
                if(toolId === 'dice') btn.classList.add('border-indigo-400', 'bg-indigo-50');
                if(toolId === 'picker') btn.classList.add('border-emerald-400', 'bg-emerald-50');
                if(toolId === 'timer') btn.classList.add('border-red-400', 'bg-red-50');
            }
        }

        // --- 1. MONEDA ---
        function flipCoin() {
            const coin = document.getElementById('theCoin');
            const resultText = document.getElementById('coinResult');
            const isHeads = Math.random() < 0.5;
            
            coin.style.transition = 'none';
            coin.style.transform = 'rotateY(0deg)';
            
            setTimeout(() => {
                coin.style.transition = 'transform 3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                const rotate = 1800 + (isHeads ? 0 : 180); 
                coin.style.transform = `rotateY(${rotate}deg)`;
            }, 50);

            resultText.innerText = "Girant...";
            resultText.className = "mt-6 text-xl font-bold text-slate-400 min-h-[2rem]";

            setTimeout(() => {
                resultText.innerText = isHeads ? "RESULTAT: CARA" : "RESULTAT: CREU";
                if(isHeads) resultText.className = "mt-6 text-xl font-bold text-yellow-600";
                else resultText.className = "mt-6 text-xl font-bold text-yellow-700";
                confetti({ particleCount: 50, spread: 50, origin: { y: 0.7 } });
            }, 3000);
        }

        // --- 2. DAUS ---
        function rollDice() {
            const type = parseInt(document.getElementById('diceType').value);
            const count = parseInt(document.getElementById('diceCount').value);
            const container = document.getElementById('diceContainer');
            const totalDisplay = document.getElementById('diceTotal');
            
            container.innerHTML = '';
            let total = 0;

            for(let i=0; i<count; i++) {
                const result = Math.floor(Math.random() * type) + 1;
                total += result;

                const die = document.createElement('div');
                die.className = 'die';
                die.innerText = result;
                
                if (type === 20 && result === 20) {
                    die.style.backgroundColor = '#dcfce7'; 
                    die.style.color = '#166534';
                    die.style.borderColor = '#22c55e';
                } else if (type === 20 && result === 1) {
                    die.style.backgroundColor = '#fee2e2'; 
                    die.style.color = '#991b1b';
                }

                container.appendChild(die);
            }

            totalDisplay.classList.remove('hidden');
            totalDisplay.innerText = `Total: ${total}`;
        }

        // --- 3. SORTEIG ---
        let pickerInterval;
        function pickWinner() {
            const text = document.getElementById('pickerInput').value;
            const names = text.split('\n').map(n => n.trim()).filter(n => n.length > 0);
            const resultEl = document.getElementById('pickerResult');

            if(names.length < 2) {
                alert("Escriu almenys dos noms!");
                return;
            }

            if(pickerInterval) clearInterval(pickerInterval);

            let counter = 0;
            const duration = 2000;
            const speed = 100;

            pickerInterval = setInterval(() => {
                const rand = Math.floor(Math.random() * names.length);
                resultEl.innerText = names[rand];
                resultEl.style.opacity = 0.5;
                counter += speed;

                if(counter >= duration) {
                    clearInterval(pickerInterval);
                    const winnerIndex = Math.floor(Math.random() * names.length);
                    resultEl.innerText = names[winnerIndex];
                    resultEl.style.opacity = 1;
                    resultEl.style.transform = "scale(1.2)";
                    setTimeout(() => resultEl.style.transform = "scale(1)", 200);
                    confetti();
                }
            }, speed);
        }

        // --- 4. TEMPORITZADOR PERSONALITZABLE ---
        let timerTime = 0;
        let initialTime = 0;
        let timerIntervalId = null;
        let timerRunning = false;
        
        const circle = document.getElementById('timerProgress');
        const totalDash = 817; // 2 * pi * 130
        const displayDiv = document.getElementById('timerDisplay');
        const configDiv = document.getElementById('timerConfig');
        const inputMin = document.getElementById('inputMin');
        const inputSec = document.getElementById('inputSec');
        const resetBtn = document.getElementById('timerResetBtn');

        function updateTimerDisplay() {
            const m = Math.floor(timerTime / 60).toString().padStart(2, '0');
            const s = (timerTime % 60).toString().padStart(2, '0');
            displayDiv.innerText = `${m}:${s}`;
            
            // Actualitzar cercle
            if(initialTime > 0) {
                const offset = totalDash - (timerTime / initialTime) * totalDash;
                circle.style.strokeDashoffset = offset;
            }
        }

        function toggleTimer() {
            const btn = document.getElementById('timerToggleBtn');

            if (!timerRunning) {
                // START
                // Si no estem pausats (és un inici nou), agafar valors dels inputs
                if(timerTime === 0 && initialTime === 0) {
                    const m = parseInt(inputMin.value) || 0;
                    const s = parseInt(inputSec.value) || 0;
                    
                    if(m === 0 && s === 0) return alert("Posa algun temps!");

                    timerTime = (m * 60) + s;
                    initialTime = timerTime;
                    
                    // Canviar vista de config a display
                    configDiv.classList.add('hidden');
                    displayDiv.classList.remove('hidden');
                    resetBtn.classList.remove('hidden');
                    updateTimerDisplay();
                }

                timerRunning = true;
                btn.innerHTML = '<i data-lucide="pause" class="w-5 h-5"></i> PAUSAR';
                btn.className = "w-full py-3 bg-yellow-500 hover:bg-yellow-600 text-white font-bold rounded-xl shadow-lg transition flex items-center justify-center gap-2";
                
                timerIntervalId = setInterval(() => {
                    if (timerTime > 0) {
                        timerTime--;
                        updateTimerDisplay();
                    } else {
                        // FI DEL TEMPS
                        clearInterval(timerIntervalId);
                        timerRunning = false;
                        initialTime = 0; // Reset per permetre nova configuració
                        btn.innerHTML = '<i data-lucide="rotate-ccw" class="w-5 h-5"></i> TEMPS ACABAT';
                        btn.className = "w-full py-3 bg-slate-700 hover:bg-slate-800 text-white font-bold rounded-xl shadow-lg transition flex items-center justify-center gap-2";
                        confetti();
                    }
                }, 1000);

            } else {
                // PAUSE
                clearInterval(timerIntervalId);
                timerRunning = false;
                btn.innerHTML = '<i data-lucide="play" class="w-5 h-5"></i> REPRENDRE';
                btn.className = "w-full py-3 bg-emerald-500 hover:bg-emerald-600 text-white font-bold rounded-xl shadow-lg transition flex items-center justify-center gap-2";
            }
            lucide.createIcons();
        }

        function resetTimer() {
            clearInterval(timerIntervalId);
            timerRunning = false;
            timerTime = 0;
            initialTime = 0;
            
            // UI Reset
            circle.style.strokeDashoffset = 0;
            displayDiv.classList.add('hidden');
            configDiv.classList.remove('hidden');
            resetBtn.classList.add('hidden');
            
            const btn = document.getElementById('timerToggleBtn');
            btn.innerHTML = '<i data-lucide="play" class="w-5 h-5"></i> INICIAR';
            btn.className = "w-full py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-xl shadow-lg shadow-red-200 transition flex items-center justify-center gap-2";
            lucide.createIcons();
        }

        // Iniciar aplicació mostrant només la moneda
        switchTool('coin');

    </script>
</body>
</html>
