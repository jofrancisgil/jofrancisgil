<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rellotge Interactiu - Jo Recursos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;600&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        h1, h2, h3, .brand-font { font-family: 'Fredoka', sans-serif; }
        
        /* rea d'interacci贸 del rellotge */
        #clock-interaction-area {
            touch-action: none; 
            cursor: grab;
        }
        #clock-interaction-area:active {
            cursor: grabbing;
        }

        /* Animaci贸 de les busques */
        .hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); /* Efecte rebot suau */
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
        }
        
        /* Treure transici贸 mentre s'arrossega per resposta instantnia */
        body.dragging .hand { transition: none; }

        /* N煤meros del rellotge */
        .clock-number {
            position: absolute;
            width: 30px;
            height: 30px;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            color: #064e3b; /* emerald-900 */
            font-size: 1.25rem;
            transform: translate(-50%, -50%);
            font-family: 'Fredoka', sans-serif;
        }

        /* Feedback visual (Validaci贸) */
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .success-pulse { animation: pulse-green 1s infinite; border-color: #10b981 !important; }
        .error-pulse { animation: pulse-red 1s infinite; border-color: #ef4444 !important; }
    </style>
</head>
<body class="bg-emerald-50 text-gray-800 min-h-screen flex flex-col">

    <!-- Navegaci贸 -->
    <nav class="bg-white shadow-md sticky top-0 z-50 no-print">
        <div class="max-w-7xl mx-auto px-4 flex justify-between h-20 items-center">
            <a href="matematiques.html" class="flex items-center gap-2 text-gray-600 hover:text-emerald-600 transition">
                <i data-lucide="arrow-left" class="w-5 h-5"></i> Tornar a Mates
            </a>
            <span class="text-2xl font-bold text-emerald-900 brand-font">Rellotge Interactiu</span>
        </div>
    </nav>

    <main class="flex-grow py-8 px-4 flex flex-col items-center justify-center">
        
        <div class="w-full max-w-lg bg-white p-6 md:p-10 rounded-2xl shadow-xl border border-emerald-100">
            
            <!-- Cap莽alera Eina -->
            <header class="flex justify-between items-center mb-8">
                <h1 class="text-xl font-bold text-emerald-900 flex items-center gap-2">
                    <div class="p-2 bg-emerald-100 rounded-lg text-emerald-600">
                        <i data-lucide="clock" class="w-6 h-6"></i>
                    </div>
                    Aprendre les Hores
                </h1>
                
                <!-- Toggle Imant -->
                <label class="flex items-center cursor-pointer text-sm font-medium text-slate-600 select-none bg-slate-50 px-3 py-1.5 rounded-full border border-slate-200">
                    <span class="mr-2 text-xs uppercase font-bold text-emerald-700">Imant 5m</span>
                    <input type="checkbox" id="snap-toggle" class="sr-only peer" checked>
                    <div class="relative w-9 h-5 bg-slate-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-emerald-500"></div>
                </label>
            </header>

            <!-- Selector de Mode -->
            <div class="grid grid-cols-3 gap-2 mb-10 bg-emerald-50 p-1.5 rounded-xl">
                <button onclick="setMode('lliure')" id="mode-lliure-btn" class="py-2 rounded-lg font-bold text-sm transition-all bg-white shadow text-emerald-700 ring-1 ring-emerald-100">
                    Lliure
                </button>
                <button onclick="setMode('quiz')" id="mode-quiz-btn" class="py-2 rounded-lg font-bold text-sm transition-all text-slate-500 hover:bg-emerald-100/50 hover:text-emerald-700">
                    Repte
                </button>
                <button onclick="setMode('aprenentatge')" id="mode-aprenentatge-btn" class="py-2 rounded-lg font-bold text-sm transition-all text-slate-500 hover:bg-emerald-100/50 hover:text-emerald-700">
                    Practicar
                </button>
            </div>

            <!-- Rellotge Visual -->
            <div class="relative w-72 h-72 sm:w-80 sm:h-80 mx-auto mb-10 select-none">
                <!-- rea d'interacci贸 -->
                <div id="clock-interaction-area" class="absolute inset-[-20px] rounded-full z-30" title="Arrossega per moure"></div>

                <!-- Tauler -->
                <div id="clock-container" class="w-full h-full bg-white rounded-full border-8 border-emerald-900 shadow-[inset_0_0_30px_rgba(0,0,0,0.05)] relative transition-colors duration-300">
                    
                    <!-- N煤meros (generats per JS) -->
                    <div id="clock-numbers" class="absolute inset-0 pointer-events-none"></div>

                    <!-- Marques de minuts -->
                    <div id="clock-markers" class="absolute inset-0 pointer-events-none"></div>

                    <!-- Busques -->
                    <!-- Hora -->
                    <div id="hour-hand" class="hand w-3 h-[28%] bg-emerald-900 rounded-full z-10 origin-bottom"></div>
                    <!-- Minuts -->
                    <div id="minute-hand" class="hand w-1.5 h-[42%] bg-emerald-500 rounded-full z-20 origin-bottom shadow-md"></div>

                    <!-- Punt central -->
                    <div class="absolute left-1/2 top-1/2 w-5 h-5 -translate-x-1/2 -translate-y-1/2 bg-white rounded-full border-4 border-emerald-600 z-40 shadow-sm"></div>
                </div>
            </div>

            <!-- ZONA DE CONTINGUT (Canvia segons el mode) -->
            <div class="min-h-[120px]">
                
                <!-- MODE 1: Lliure -->
                <div id="digital-display-area" class="text-center animate-in fade-in slide-in-from-bottom-4 duration-300">
                    <div class="inline-block bg-slate-800 text-emerald-400 font-mono text-5xl px-8 py-4 rounded-xl shadow-lg border-b-4 border-slate-950 relative">
                        <span id="digital-display">12:00</span>
                        <span class="absolute top-2 right-3 text-[10px] text-slate-500 font-sans font-bold tracking-widest">DIGITAL</span>
                    </div>
                    <p class="text-slate-400 mt-4 text-sm flex items-center justify-center gap-1">
                        <i data-lucide="mouse-pointer-2" class="w-4 h-4"></i>
                        Arrossega les busques per canviar l'hora
                    </p>
                </div>

                <!-- MODE 2: Quiz -->
                <div id="quiz-area" class="text-center hidden animate-in fade-in slide-in-from-bottom-4 duration-300">
                    <div class="bg-blue-50 border border-blue-100 p-4 rounded-xl mb-4">
                        <p class="text-xs text-blue-600 font-bold uppercase tracking-wider mb-1">POSA AQUESTA HORA</p>
                        <h3 id="quiz-question" class="text-4xl font-bold text-slate-800 tracking-tight">...</h3>
                    </div>
                    <button id="validate-btn" class="w-full bg-emerald-600 hover:bg-emerald-700 active:scale-95 text-white font-bold py-3 px-6 rounded-xl shadow-lg shadow-emerald-200 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="check-circle" class="w-5 h-5"></i>
                        Comprovar Resposta
                    </button>
                    <p id="quiz-message" class="text-lg font-bold mt-4 min-h-[1.75rem] transition-all"></p>
                </div>

                <!-- MODE 3: Aprenentatge -->
                <div id="aprenentatge-area" class="text-center hidden animate-in fade-in slide-in-from-bottom-4 duration-300">
                    <div class="mb-4">
                        <button id="com-es-diu-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 active:scale-95 text-white font-bold py-3 px-6 rounded-xl shadow-lg shadow-indigo-200 transition-all flex items-center justify-center gap-2">
                            <i data-lucide="volume-2" class="w-5 h-5"></i>
                            Com es diu aquesta hora?
                        </button>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 min-h-[80px] flex items-center justify-center relative overflow-hidden">
                        <p id="aprenentatge-resultat" class="text-xl font-bold text-slate-400">
                            Mou el rellotge i clica el bot贸...
                        </p>
                    </div>
                </div>

            </div>

        </div>
    </main>

    <footer class="bg-white border-t py-8 mt-auto no-print">
        <div class="max-w-6xl mx-auto px-4 text-center text-sm text-gray-500">
            <p>&copy; 2025 Jo Recursos.</p>
        </div>
    </footer>

    <script>
        lucide.createIcons();

        document.addEventListener('DOMContentLoaded', () => {
            // Refer猫ncies
            const clockContainer = document.getElementById('clock-container');
            const hourHand = document.getElementById('hour-hand');
            const minuteHand = document.getElementById('minute-hand');
            const digitalDisplay = document.getElementById('digital-display');
            const snapToggle = document.getElementById('snap-toggle');
            
            // rees
            const areas = {
                lliure: document.getElementById('digital-display-area'),
                quiz: document.getElementById('quiz-area'),
                aprenentatge: document.getElementById('aprenentatge-area')
            };

            // Elements Quiz
            const quizQuestion = document.getElementById('quiz-question');
            const quizMessage = document.getElementById('quiz-message');

            // Elements Aprenentatge
            const aprenentatgeResultat = document.getElementById('aprenentatge-resultat');

            // Estat
            let totalMinutes = 0; 
            let targetTime = { h: 12, m: 0 };
            let isDragging = false;
            let currentMode = 'lliure';

            // --- INICIALITZACI VISUAL ---
            
            function initClockFace() {
                const numbersContainer = document.getElementById('clock-numbers');
                const markersContainer = document.getElementById('clock-markers');
                
                // Generar marcadors
                for (let i = 1; i <= 60; i++) {
                    const marker = document.createElement('div');
                    const isHour = i % 5 === 0;
                    
                    marker.style.position = 'absolute';
                    marker.style.left = '50%';
                    marker.style.top = '50%';
                    marker.style.width = isHour ? '4px' : '2px';
                    marker.style.height = isHour ? '12px' : '6px';
                    marker.style.backgroundColor = isHour ? '#064e3b' : '#cbd5e1'; // emerald-900 / slate-300
                    marker.style.transformOrigin = 'center';
                    // Movem el marcador a la vora
                    marker.style.transform = `translate(-50%, -50%) rotate(${i * 6}deg) translateY(-135px)`; // radi aprox
                    
                    markersContainer.appendChild(marker);
                }

                // Generar N煤meros (1-12)
                for (let i = 1; i <= 12; i++) {
                    const num = document.createElement('div');
                    num.className = 'clock-number';
                    num.textContent = i;
                    
                    // Matemtiques per posicionar en cercle
                    const angle = (i * 30) * (Math.PI / 180);
                    const radius = 112; // Ajustar segons mida rellotge
                    // x = r * sin(a), y = -r * cos(a) per tenir 0 a dalt
                    const x = Math.sin(angle) * radius;
                    const y = -Math.cos(angle) * radius;

                    num.style.left = `calc(50% + ${x}px)`;
                    num.style.top = `calc(50% + ${y}px)`;
                    
                    numbersContainer.appendChild(num);
                }
            }

            // --- LGICA RELLOTGE ---

            function updateClock(minutes) {
                totalMinutes = minutes;
                
                // Normalitzem per mostrar
                const hours = Math.floor(totalMinutes / 60);
                const mins = totalMinutes % 60;
                
                // Angles
                const minAngle = mins * 6;
                const hourAngle = (hours % 12) * 30 + (mins * 0.5);

                minuteHand.style.transform = `translateX(-50%) rotate(${minAngle}deg)`;
                hourHand.style.transform = `translateX(-50%) rotate(${hourAngle}deg)`;

                // Digital
                const displayH = hours === 0 ? 12 : (hours > 12 ? hours - 12 : hours);
                const fixedH = hours === 0 ? 12 : hours; // Mantenim 1-12
                digitalDisplay.textContent = `${String(fixedH).padStart(2, ' ')}:${String(mins).padStart(2, '0')}`;
                
                // Si estem en mode aprenentatge i no arrosseguem, netegem text per convidar a clicar bot贸
                if (currentMode === 'aprenentatge' && !isDragging) {
                    aprenentatgeResultat.classList.remove('text-indigo-600');
                    aprenentatgeResultat.classList.add('text-slate-400');
                }
            }

            // --- INTERACCI ---

            function handleDrag(e) {
                if (!isDragging) return;
                e.preventDefault();

                const rect = clockContainer.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;

                const dx = clientX - centerX;
                const dy = clientY - centerY;

                // Angle on el 0 茅s a les 12 (amunt)
                let angle = Math.atan2(dy, dx) * (180 / Math.PI) + 90;
                if (angle < 0) angle += 360;

                let mins = Math.round(angle / 0.5); // 0.5 graus per minut en una esfera de 12h (720 min)
                
                // L貌gica "Snap to 5m"
                if (snapToggle.checked) {
                    mins = Math.round(mins / 5) * 5;
                }
                
                mins = mins % 720; // Assegurar 0-719

                updateClock(mins);
            }

            const interactionArea = document.getElementById('clock-interaction-area');
            
            const startDrag = (e) => { isDragging = true; document.body.classList.add('dragging'); handleDrag(e); };
            const stopDrag = () => { isDragging = false; document.body.classList.remove('dragging'); };

            interactionArea.addEventListener('mousedown', startDrag);
            window.addEventListener('mousemove', handleDrag);
            window.addEventListener('mouseup', stopDrag);

            interactionArea.addEventListener('touchstart', startDrag, {passive: false});
            window.addEventListener('touchmove', handleDrag, {passive: false});
            window.addEventListener('touchend', stopDrag);

            // --- LGICA CATAL (TEXT I VEU) ---

            function getHoraEnCatala(minutes) {
                const hoursRaw = Math.floor(minutes / 60);
                const m = minutes % 60;
                
                let hActual = hoursRaw === 0 ? 12 : hoursRaw;
                let hNext = (hActual % 12) + 1;
                
                const nums = ["", "una", "dues", "tres", "quatre", "cinc", "sis", "set", "vuit", "nou", "deu", "onze", "dotze"];
                
                // Helpers
                const getArt = (h) => (h === 1 || h === 11) ? "d'" : "de ";
                const getVerb = (h) => (h === 1) ? "s " : "S贸n ";
                const getArtLa = (h) => (h === 1) ? "la " : "les ";

                // 1. En punt
                if (m === 0) return `${getVerb(hActual)}${getArtLa(hActual)}${nums[hActual]} en punt`;
                
                // 2. Quarts plens
                if (m === 15) return `s un quart ${getArt(hNext)}${nums[hNext]}`;
                if (m === 30) return `S贸n dos quarts ${getArt(hNext)}${nums[hNext]}`;
                if (m === 45) return `S贸n tres quarts ${getArt(hNext)}${nums[hNext]}`;

                // 3. Intervals
                if (m < 15) {
                    return `${getVerb(hActual)}${getArtLa(hActual)}${nums[hActual]} i ${m} minuts`;
                } else if (m < 30) {
                    let diff = m - 15;
                    return `s un quart i ${diff} ${diff===1?'minut':'minuts'} ${getArt(hNext)}${nums[hNext]}`;
                } else if (m < 45) {
                    let diff = m - 30;
                    return `S贸n dos quarts i ${diff} ${diff===1?'minut':'minuts'} ${getArt(hNext)}${nums[hNext]}`;
                } else {
                    let diff = m - 45;
                    return `S贸n tres quarts i ${diff} ${diff===1?'minut':'minuts'} ${getArt(hNext)}${nums[hNext]}`;
                }
            }

            function speakText(text) {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ca-ES'; 
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                }
            }

            // --- GESTI DE MODES ---

            window.setMode = function(mode) {
                currentMode = mode;
                
                // UI Botons
                ['lliure', 'quiz', 'aprenentatge'].forEach(m => {
                    const btn = document.getElementById(`mode-${m}-btn`);
                    if (m === mode) {
                        // Estil actiu (Emerald)
                        btn.className = "py-2 rounded-lg font-bold text-sm transition-all bg-white shadow text-emerald-700 ring-1 ring-emerald-100 transform scale-105";
                        areas[m].classList.remove('hidden');
                    } else {
                        // Estil inactiu
                        btn.className = "py-2 rounded-lg font-bold text-sm transition-all text-slate-500 hover:bg-emerald-100/50 hover:text-emerald-700";
                        areas[m].classList.add('hidden');
                    }
                });

                // Neteja estats
                clockContainer.classList.remove('success-pulse', 'error-pulse');
                quizMessage.textContent = '';
                
                if (mode === 'quiz') startQuiz();
            };

            // --- QUIZ LOGIC ---

            function startQuiz() {
                const h = Math.floor(Math.random() * 12) + 1;
                const m = Math.floor(Math.random() * 12) * 5; // intervals de 5
                
                targetTime = { h, m };
                
                quizQuestion.textContent = `${h}:${String(m).padStart(2, '0')}`;
                quizMessage.textContent = "";
            }

            document.getElementById('validate-btn').addEventListener('click', () => {
                const currentH = Math.floor(totalMinutes / 60);
                const fixedCurrentH = currentH === 0 ? 12 : currentH;
                const currentM = totalMinutes % 60;

                const targetTotal = (targetTime.h === 12 ? 0 : targetTime.h) * 60 + targetTime.m;
                const checkTotal = (fixedCurrentH === 12 ? 0 : fixedCurrentH) * 60 + currentM;

                const diff = Math.abs(targetTotal - checkTotal);

                if (diff <= 2) {
                    // xit
                    quizMessage.innerHTML = "<span class='flex items-center justify-center gap-2'>Molt b茅! </span>";
                    quizMessage.className = "text-lg font-bold mt-4 text-emerald-600";
                    clockContainer.classList.add('success-pulse');
                    speakText("Molt b茅!");
                    setTimeout(() => {
                        clockContainer.classList.remove('success-pulse');
                        startQuiz();
                    }, 2000);
                } else {
                    // Error
                    quizMessage.innerHTML = `Encara no. Has posat les ${fixedCurrentH}:${String(currentM).padStart(2, '0')}`;
                    quizMessage.className = "text-lg font-bold mt-4 text-red-500";
                    clockContainer.classList.add('error-pulse');
                    setTimeout(() => clockContainer.classList.remove('error-pulse'), 1000);
                }
            });

            // --- APRENENTATGE LOGIC ---

            document.getElementById('com-es-diu-btn').addEventListener('click', () => {
                const text = getHoraEnCatala(totalMinutes);
                aprenentatgeResultat.textContent = text;
                aprenentatgeResultat.classList.remove('text-slate-400');
                aprenentatgeResultat.classList.add('text-indigo-700');
                speakText(text);
            });

            // Start
            initClockFace();
            updateClock(720); // 12:00
        });
    </script>
</body>
</html>
